# 多语言支持

<cite>
**本文档中引用的文件**  
- [en.toml](file://themes/void/i18n/en.toml)
- [zh.toml](file://themes/void/i18n/zh.toml)
- [menu.html](file://themes/void/layouts/partials/menu.html)
- [list.html](file://themes/void/layouts/_default/list.html)
- [single.html](file://themes/void/layouts/_default/single.html)
- [hugo.toml](file://hugo.toml)
</cite>

## 目录
1. [简介](#简介)
2. [翻译文件结构分析](#翻译文件结构分析)
3. [Hugo i18n 系统工作机制](#hugo-i18n-系统工作机制)
4. [模板中的国际化文本渲染](#模板中的国际化文本渲染)
5. [添加新语言或翻译条目](#添加新语言或翻译条目)
6. [语言切换功能测试方法](#语言切换功能测试方法)

## 简介
本项目基于 Hugo 静态网站生成器实现多语言支持，通过 `i18n` 国际化系统提供中英文双语界面。系统根据用户语言偏好自动加载对应的语言包，并将翻译键映射到页面元素如菜单项、按钮文本等。该机制确保内容在不同语言环境下保持一致性和可维护性。

## 翻译文件结构分析
项目包含两个主要的翻译配置文件：`en.toml` 和 `zh.toml`，分别定义了英文和中文的本地化字符串。每个文件采用 TOML 格式组织键值对，其中键为统一的标识符（如 `list_read_more`），值则为对应语言的实际显示文本。

例如，在 `en.toml` 中：
```toml
[list_read_more]
other = "Read more"
```

而在 `zh.toml` 中：
```toml
[list_read_more]
other = "阅读全文"
```

所有键均以方括号 `[key_name]` 定义，`other` 字段表示默认语言环境下的翻译文本。这种结构使得开发者可以轻松扩展更多语言变体而无需修改模板代码。

**节来源**
- [en.toml](file://themes/void/i18n/en.toml#L0-L154)
- [zh.toml](file://themes/void/i18n/zh.toml#L0-L166)

## Hugo i18n 系统工作机制
Hugo 的 i18n 系统依据站点配置和浏览器语言设置自动选择合适的语言包。当前项目的主配置文件 `hugo.toml` 指定了默认语言为 `'en-us'`：

```toml
languageCode = 'en-us'
```

当用户访问网站时，Hugo 会检查 HTTP 请求头中的 `Accept-Language` 字段。若检测到中文（如 `zh-CN` 或 `zh-TW`），系统将优先加载 `zh.toml` 文件中的翻译；否则使用 `en.toml`。此过程完全自动化，无需手动干预。

此外，可通过 URL 路径前缀显式指定语言版本（需额外配置多语言路由），但当前项目未启用该功能，依赖于浏览器语言检测机制。

**节来源**
- [hugo.toml](file://hugo.toml#L2-L28)

## 模板中的国际化文本渲染
在 Hugo 模板中，通过内置函数 `T` 调用翻译键来实现动态文本渲染。例如，在文章列表页 `list.html` 中，"阅读全文" 按钮的文本由以下代码生成：

```html
{{ i18n "list_read_more" | default "阅读全文" }}
```

此处 `i18n` 函数等价于 `T`，查找当前语言环境中 `list_read_more` 对应的翻译。`| default` 提供后备值，以防翻译缺失。

另一个典型用例是分页控件：
```html
{{ i18n "pagination_previous" | default "上一页" }}
```
这确保了“上一页”和“下一页”按钮能随语言切换而变化。

菜单项也支持国际化。在 `menu.html` 中，若菜单项的 `Identifier` 设置为某个翻译键（如 `Home`），系统会尝试通过 `T` 函数获取其本地化名称：

```go
{{ with .Identifier }}
  {{ with T . }}
    {{ $name = . }}
  {{ end }}
{{ end }}
```

这意味着只要 `.Identifier` 匹配一个有效的翻译键，菜单文本就会自动本地化。

**节来源**
- [menu.html](file://themes/void/layouts/partials/menu.html#L0-L52)
- [list.html](file://themes/void/layouts/_default/list.html#L0-L89)
- [single.html](file://themes/void/layouts/_default/single.html#L0-L81)

## 添加新语言或翻译条目
要添加新的翻译条目，请按以下步骤操作：

1. **编辑现有语言文件**：打开 `themes/void/i18n/zh.toml` 或 `en.toml`，添加新的键值对。例如：
   ```toml
   [new_feature]
   other = "新功能介绍"
   ```

2. **在模板中调用新键**：
   ```html
   {{ i18n "new_feature" | default "New Feature" }}
   ```

3. **添加新语言支持**：
   - 在 `i18n` 目录下创建新的 `.toml` 文件，如 `fr.toml` 表示法语。
   - 在 `hugo.toml` 中配置多语言选项（当前未启用）：
     ```toml
     [languages]
       [languages.en]
         languageName = "English"
         weight = 1
       [languages.zh]
         languageName = "简体中文"
         weight = 2
     ```

4. **更新菜单配置**：如果菜单项需要本地化，确保其 `Identifier` 与翻译键一致，而非硬编码文本。

完成上述更改后，重新构建网站即可生效。

**节来源**
- [en.toml](file://themes/void/i18n/en.toml#L0-L154)
- [zh.toml](file://themes/void/i18n/zh.toml#L0-L166)
- [hugo.toml](file://hugo.toml#L2-L28)

## 语言切换功能测试方法
验证语言切换是否正常工作的测试方法如下：

1. **浏览器语言设置测试**：
   - 将浏览器语言首选项设为 `中文 (zh-CN)`，刷新页面，确认所有文本（如“阅读全文”、“返回首页”）已正确显示为中文。
   - 切换回 `英语 (en-US)`，再次刷新，验证是否恢复为英文。

2. **直接调用翻译函数测试**：
   在模板中临时插入调试语句：
   ```html
   <!-- 调试输出 -->
   当前语言: {{ .Site.Language.Lang }} <br>
   测试键 list_read_more: {{ T "list_read_more" }}
   ```
   查看输出结果是否符合预期。

3. **检查生成的 HTML 输出**：
   构建站点后查看 `public/` 目录下的 HTML 文件，确认 `<html lang="zh">` 或 `<html lang="en">` 正确设置（当前项目未显式输出 lang 属性，可考虑增强）。

4. **新增翻译键验证**：
   添加一个测试键（如 `test_translation`）至 `zh.toml` 和 `en.toml`，然后在模板中调用并观察是否正确渲染。

5. **缺失翻译回退测试**：
   故意删除某语言文件中的某个键，确认是否正确回退到 `| default` 指定的默认值。

这些测试可确保国际化系统稳定运行，并能在未来扩展时快速发现问题。

**节来源**
- [list.html](file://themes/void/layouts/_default/list.html#L0-L89)
- [single.html](file://themes/void/layouts/_default/single.html#L0-L81)
- [en.toml](file://themes/void/i18n/en.toml#L0-L154)
- [zh.toml](file://themes/void/i18n/zh.toml#L0-L166)